generator client {
    provider   = "prisma-client"
    output     = "../generated/prisma"
    engineType = "client"
    runtime    = "bun"
}

datasource db {
    provider = "postgresql"
}

enum IntegrationType {
    ixcsoft
    tsmxsgp
}

model Companies {
    id           String        @id @default(uuid())
    name         String
    slug         String        @unique
    is_active    Boolean       @default(true)
    integrations Integration[]
    tokens       CompanyToken[]
    created_at   DateTime      @default(now())
    updated_at   DateTime      @updatedAt
}

model Integration {
    id         String   @id @default(uuid())
    company_id String
    type     IntegrationType
    is_active  Boolean  @default(true)
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    company    Companies        @relation(fields: [company_id], references: [id], onDelete: Cascade)
    tokens     CompanyToken[]
    ixcConfig  IXCConfig?
    sgpConfig  SGPConfig?

    @@unique([company_id, type])
}

model IXCConfig {
    id             String      @id @default(uuid())
    integration_id String      @unique
    base_url       String      // encrypted
    token          String      // encrypted

    integration Integration @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model SGPConfig {
    id             String      @id @default(uuid())
    integration_id String      @unique
    base_url       String      // encrypted
    app            String      // encrypted
    token          String      // encrypted

    integration Integration @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model CompanyToken {
    id             String      @id @default(uuid())
    company_id     String
    integration_id String
    token_hash     String      @unique
    description    String?
    is_active      Boolean     @default(true)
    expires_at     DateTime?
    last_used_at   DateTime?
    created_at     DateTime    @default(now())

    company     Companies   @relation(fields: [company_id], references: [id], onDelete: Cascade)
    integration Integration @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}